/*
* Copyright (c) 2021 De Staat der Nederlanden, Ministerie van Volksgezondheid, Welzijn en Sport.
*  Licensed under the EUROPEAN UNION PUBLIC LICENCE v. 1.2
*
*  SPDX-License-Identifier: EUPL-1.2
*/

@testable import CTR
import XCTest
import Nimble

class OpenSSLTests: XCTestCase {

	var sut = OpenSSL()

	override func setUp() {

		super.setUp()
		sut = OpenSSL()
	}

	let rootCertificateData = Data(base64Encoded: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURoekNDQW0rZ0F3SUJBZ0lKQUs2d3FVcEswaVhTTUEwR0NTcUdTSWIzRFFFQkN3VUFNRm94S3pBcEJnTlYKQkFNTUlsTjBZV0YwSUdSbGNpQk9aV1JsY214aGJtUmxiaUJTYjI5MElFTkJJQzBnUnpNeEhqQWNCZ05WQkFvTQpGVk4wWVdGMElHUmxjaUJPWldSbGNteGhibVJsYmpFTE1Ba0dBMVVFQmhNQ1Rrd3dIaGNOTWpFd09EQTFNVEV5Ck5qQTVXaGNOTWpJd09EQTFNVEV5TmpBNVdqQmFNU3N3S1FZRFZRUUREQ0pUZEdGaGRDQmtaWElnVG1Wa1pYSnMKWVc1a1pXNGdVbTl2ZENCRFFTQXRJRWN6TVI0d0hBWURWUVFLREJWVGRHRmhkQ0JrWlhJZ1RtVmtaWEpzWVc1awpaVzR4Q3pBSkJnTlZCQVlUQWs1TU1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBCnJHQWJlM0JMeGVBWnAzZ09WcmZGU2d2S0pJSE1PWHhaME1yZnJKaXdCQTRDZEtWb1prd282dUtxRFp0S0JEdWMKc0ZCL3dHSnFZMThzSXBpUktNeWwxbFNidU9BeVp4Vit1TEFOVERucitlcDhuclU4bjlPdGNLWFZzalVsQUM4SwpBaXNUdnRDT1VsV1l6MElUUFNSeWV4bkpwblNrdWpOK1N0ZEZSS2FRaVRkc2xsUm1RR1VjOE5TazVuaGJRT1dNCmJJZ3k5QmlISmYrZ0JrU2NCNlJXQjI1UFgxdFNyS1RnTTloQkdjZE85dUJXRVdoemh5c1FFalBGVHpRaGhMdUQKNXRTWE1lRHRtKzVEeEw4STJsVWw5UTFXSmpmc09HN25ZbWloSGZkNmpyZ1dXWmQwczk2eFlVOERKUWthTlo5bwpvYk5yNmNJNXZ4ZFlldWNTc1FNd1hRSURBUUFCbzFBd1RqQWRCZ05WSFE0RUZnUVVoaHV1WVVXV2tmRGRWQmtJCndMSUlWNHFGODk4d0h3WURWUjBqQkJnd0ZvQVVoaHV1WVVXV2tmRGRWQmtJd0xJSVY0cUY4OTh3REFZRFZSMFQKQkFVd0F3RUIvekFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBS3owemllZFZNalhqL05uRWxucmFUUzB2U2llZQpCOU9hYlp6UUxuUXJtaFNibXZuK1h0UWZQbGtPdjZmNitiL2syRkRoNVpEYzJnbVFrUW4vNXdrWU00MUZ2MENaCkVQU25DWHJMam01NU12eDdYZ1h2OVJoUFVlRm5qcnNzN3FZNjFiZkh5VXJEdnR5Z2hFRCtkdVJxUHViMTcydk4KOE9oYTVUbXF2UkxDN01LN20wRkVZR2MrSWdDdDdYUzRrN3BYcW9zUzNycGMyeG1tdWlmekVTckxoRkZhdHVmSQpFYU14Rzg3MEdYekhuWFlnTFJPTWZWeUg3ZFEwT09tT0NCZUhGVDB4OGFNSEhGNkJqZjJGcHVETFlWblNzeDd3Ck1pcm5taG5jZXpRL0hFTFA4eTRrRkI0aE55MHNHRUdZS0ZuOTFkbzlQZFp2cUhERDgxcmZBQTlpVGc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t" )!

	let authorityKeyIdentifier = Data([0x04, 0x14, /* keyID starts here: */ 0x88, 0x58, 0x4D, 0x77, 0xE3, 0x87, 0x8B, 0xCF, 0x30, 0x63, 0xDF, 0x9A, 0x9C, 0x40, 0xD5, 0xD7, 0xD6, 0x57, 0xED, 0x93 ])

	let payload = Data(base64Encoded: "WwogeyJhZm5hbWVkYXR1bSI6IjIwMjAtMDYtMTdUMTA6MDA6MDAuMDAwKzAyMDAiLAogICJ1aXRzbGFnZGF0dW0iOiIyMDIwLTA2LTE3VDEwOjEwOjAwLjAwMCswMjAwIiwKICAicmVzdWx0YWF0IjoiTkVHQVRJRUYiLAogICJhZnNwcmFha1N0YXR1cyI6IkFGR0VST05EIiwKICAiYWZzcHJhYWtJZCI6Mjc4NzE3Njh9LAogeyJhZm5hbWVkYXR1bSI6IjIwMjAtMTEtMDhUMTA6MTU6MDAuMDAwKzAxMDAiLAogICAidWl0c2xhZ2RhdHVtIjoiMjAyMC0xMS0wOVQwNzo1MDozOS4wMDArMDEwMCIsCiAgICJyZXN1bHRhYXQiOiJQT1NJVElFRiIsCiAgICJhZnNwcmFha1N0YXR1cyI6IkFGR0VST05EIiwKICAgImFmc3ByYWFrSWQiOjI1ODcxOTcyMTl9Cl0K" )!

	let wrongPayload = Data(base64Encoded: "WwogeyJhZm5hbWVkYXR1bSI6IjIwMjAtMDYtMTdUMTA6MDA6MDAuMDAwKzAyMDAiLAogICJ1aXRzbGFnZGF0dW0iOiIyMDIwLTA2LTE3VDEwOjEwOjAwLjAwMCswMjAwIiwKICAicmVzdWx0YWF0IjoiTkVHQVRJRUYiLAogICJhZnNwcmFha1N0YXR1cyI6IkFGR0VST05EIiwKICAiYWZzcHJhYWtJZCI6Mjc4NzE3Njh9LAogeyJhZm5hbWVkYXR1bSI6IjIwMjAtMTEtMDhUMTA6MTU6MDAuMDAwKzAxMDAiLAogICAidWl0c2xhZ2RhdHVtIjoiMjAyMC0xMS0wOVQwNzo1MDozOS4wMDArMDEwMCIsCiAgICJyZXN1bHRhYXQiOiJQT1NJVElFRiIsCiAgICJhZnNwcmFha1N0YXR1cyI6IkFGR0VST05EIiwKICAgImFmc3ByYWFrSWQiOjI1ODcxOTcyMTl9Cl1K" )!

	let signaturePKCS = Data(base64Encoded: "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")!

	let signaturePPS = Data(base64Encoded: "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")!

	// MARK: - Signature

	func testCMSSignature_padding_pkcs_validPayload() {

		// Given
		expect(self.sut).toNot(beNil())

		// When
		let validation = sut.validatePKCS7Signature(
			signaturePKCS,
			contentData: payload,
			certificateData: rootCertificateData,
			authorityKeyIdentifier: authorityKeyIdentifier,
			requiredCommonNameContent: ".coronatester.n",
			requiredCommonNameSuffix: ".nl")

		// Then
		expect(validation) == true
	}

	func testCMSSignature_padding_pkcs_wrongPayload() {

		// Given
		expect(self.sut).toNot(beNil())

		// When
		let validation = sut.validatePKCS7Signature(
			signaturePKCS,
			contentData: wrongPayload,
			certificateData: rootCertificateData,
			authorityKeyIdentifier: authorityKeyIdentifier,
			requiredCommonNameContent: ".coronatester.n",
			requiredCommonNameSuffix: ".nl")

		// Then
		expect(validation) == false
	}

	func testCMSSignature_padding_pss_validPayload() {

		// Given
		expect(self.sut).toNot(beNil())

		// When
		let validation = sut.validatePKCS7Signature(
			signaturePPS,
			contentData: payload,
			certificateData: rootCertificateData,
			authorityKeyIdentifier: authorityKeyIdentifier,
			requiredCommonNameContent: ".coronatester.n",
			requiredCommonNameSuffix: ".nl")

		// Then
		expect(validation) == true
	}

	func testCMSSignature_padding_pss_wrongPayload() {

		// Given
		expect(self.sut).toNot(beNil())

		// When
		let validation = sut.validatePKCS7Signature(
			wrongPayload,
			contentData: payload,
			certificateData: rootCertificateData,
			authorityKeyIdentifier: authorityKeyIdentifier,
			requiredCommonNameContent: ".coronatester.n",
			requiredCommonNameSuffix: ".nl")

		// Then
		expect(validation) == false
	}

	func testCMSSignature_test_pinning_wrongCommonName() {

		// Given
		expect(self.sut).toNot(beNil())

		// When
		let validation = sut.validatePKCS7Signature(
			signaturePKCS,
			contentData: payload,
			certificateData: rootCertificateData,
			authorityKeyIdentifier: authorityKeyIdentifier,
			requiredCommonNameContent: ".xx.n",
			requiredCommonNameSuffix: ".nl")

		// Then
		expect(validation) == false
	}

	func testCMSSignature_test_pinning_wrongSuffix() {

		// Given
		expect(self.sut).toNot(beNil())

		// When
		let validation = sut.validatePKCS7Signature(
			signaturePKCS,
			contentData: payload,
			certificateData: rootCertificateData,
			authorityKeyIdentifier: authorityKeyIdentifier,
			requiredCommonNameContent: ".coronatester.n",
			requiredCommonNameSuffix: ".xx"
		)

		// Then
		expect(validation) == false
	}

	func testCMSSignature_test_pinning_emptySuffix() {

		// Given
		expect(self.sut).toNot(beNil())

		// When
		let validation = sut.validatePKCS7Signature(
			signaturePKCS,
			contentData: payload,
			certificateData: rootCertificateData,
			authorityKeyIdentifier: authorityKeyIdentifier,
			requiredCommonNameContent: ".coronatester.n",
			requiredCommonNameSuffix: ""
		)

		// Then
		expect(validation) == false
	}

	func testCMSSignature_test_pinning_emptyCommonName() {

		// Given
		expect(self.sut).toNot(beNil())

		// When
		let validation = sut.validatePKCS7Signature(
			signaturePKCS,
			contentData: payload,
			certificateData: rootCertificateData,
			authorityKeyIdentifier: authorityKeyIdentifier,
			requiredCommonNameContent: "",
			requiredCommonNameSuffix: ".xx"
		)

		// Then
		expect(validation) == false
	}

	func testCMSSignature_test_pinning_all_empty() {

		// Given
		expect(self.sut).toNot(beNil())

		// When
		let validation = sut.validatePKCS7Signature(
			signaturePKCS,
			contentData: payload,
			certificateData: rootCertificateData,
			authorityKeyIdentifier: authorityKeyIdentifier,
			requiredCommonNameContent: "",
			requiredCommonNameSuffix: ""
		)

		// Then
		expect(validation) == true
	}

	func testCMSSignature_verydeep() {

//		let rootCertificateData = Data(base64Encoded: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMrekNDQWVPZ0F3SUJBZ0lVYzBPUEpXenZ2cEg3ZlZHQVVTeWg1R0o3eGhNd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0RURUxNQWtHQTFVRUF3d0NRMEV3SGhjTk1qRXdOakk1TVRreE5qVTBXaGNOTWpFd056STVNVGt4TmpVMApXakFOTVFzd0NRWURWUVFEREFKRFFUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCCkFQVktxLzRNbStKRXdOdExCUVpGU0dxaWdEZmwzeXJIRUpuZHY3UTNWYlZzdGNXL1A2OWxOdE9SdkxvS005eDYKWWxNUXIzWVgyWHdXek81cFVFMHdYLzVBV3dVam85a1Q2T0NaRzdXMXNDV2hJZDl1dWs5YkdvbUpEeFExdFl5bApqalgrUEpIV2l3U3ZOY043dWV4NGxOZlFhN01jVnN6d3c0UGpUZ0FEY2pUV3RPSGlNZytaWVQ3Z3E0NzBraUlXCnptQ1NDcDJRWWVIY2tEdjlMNks2OG0zTklGTFR0ckxOYmttZmowSTFwbG1ZT0VxNEpLOWR4RllWZXdYbXRpUVYKREJCRzJ5Ti9EK2dXN1VFbnZXTDljNGJ6VGlXQW9rcVFsem1QQ3EyUTdhR1JsL05keFJKNmhUTEVpUjVna1hwYQp0dWhuNWFaZlliK3VaZFlIRGNVNzBNTUNBd0VBQWFOVE1GRXdIUVlEVlIwT0JCWUVGQkRwMElzTWZtYnVYWm9mCklMRzUvU3hMeUlPYU1COEdBMVVkSXdRWU1CYUFGQkRwMElzTWZtYnVYWm9mSUxHNS9TeEx5SU9hTUE4R0ExVWQKRXdFQi93UUZNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFNWXRzWU1zUjVtQ2l2Q01zbnBOWjMrbQo5cDJqU1R0OHhqdXlaZSttOEhxUHo4Y3JJZHpIOEhpZ0RwRnoyR2NEaEMvQjBpZ2dwemt1Tm5MRmo1bm9iUk85ClVjMk81aHFpWlgwdlhoalNZblVHcWMzQUw2MjRSeHgwaitBdGtBNlBWVUU4RktkQ2YyTTRlWUYwNUpNb3ZtbTkKY1VsWGU5L3BUVEJUTm4yYmZqQ3Q3enFkTmR4YjVzU3doT1FNZlVBZVNBdG5oLzRKS3ZSZENIRkE2UXVqSGV0agpPTTdoalM4bjN5SG9IakxwUHJuRExTVUtkZHhuQ1hJRG9vS0lwNmJRQnJOL0JXaHhDU3VaNlRDR0dMeVQvVCs0CnNVYjFjVmJOVEx0OGQrRHJkcVRBekRXQmdOQnIrODZUeS9jZEZRM0c3YWN0ZDliSWZ6ekJhcHdpaWhaRGlQbz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo==" )!
//		let authorityKeyIdentifier = Data([    0x04, 0x14, 0x8F, 0xF8, 0xFC, 0x3E, 0xA0, 0x42, 0x3D, 0x45, 0x2D, 0x17, 0x07, 0xA1, 0xC4, 0xEB, 0x54, 0xE5, 0xFD, 0x5B, 0x32, 0x76])
//		let payload = Data(base64Encoded: "WwogeyJhZm5hbWVkYXR1bSI6IjIwMjAtMDYtMTdUMTA6MDA6MDAuMDAwKzAyMDAiLAogICJ1aXRzbGFnZGF0dW0iOiIyMDIwLTA2LTE3VDEwOjEwOjAwLjAwMCswMjAwIiwKICAicmVzdWx0YWF0IjoiTkVHQVRJRUYiLAogICJhZnNwcmFha1N0YXR1cyI6IkFGR0VST05EIiwKICAiYWZzcHJhYWtJZCI6Mjc4NzE3Njh9LAogeyJhZm5hbWVkYXR1bSI6IjIwMjAtMTEtMDhUMTA6MTU6MDAuMDAwKzAxMDAiLAogICAidWl0c2xhZ2RhdHVtIjoiMjAyMC0xMS0wOVQwNzo1MDozOS4wMDArMDEwMCIsCiAgICJyZXN1bHRhYXQiOiJQT1NJVElFRiIsCiAgICJhZnNwcmFha1N0YXR1cyI6IkFGR0VST05EIiwKICAgImFmc3ByYWFrSWQiOjI1ODcxOTcyMTl9Cl0K" )!
//
//		let signature = Data(base64Encoded: "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" )!

//		// Given
//		expect(self.sut).toNot(beNil())
//
//		// When
//		let validation = sut.validatePKCS7Signature(
//			signature,
//			contentData: payload,
//			certificateData: rootCertificateData,
//			authorityKeyIdentifier: authorityKeyIdentifier,
//			requiredCommonNameContent: "leaf",
//			requiredCommonNameSuffix: "f"
//		)
//
//		// Then
//		expect(validation) == true
	}

	// MARK: - Subject Alternative Name

	func test_subjectAlternativeNames_realLeaf() {

		// Given
		expect(self.sut).toNot(beNil())

		// When
		let sans = sut.getSubjectAlternativeDNSNames(OpenSSLData.realLeaf) as? [String]

		// Then
		expect(sans).to(haveCount(1))
		expect(sans?.first) == "api-ct.bananenhalen.nl"
	}

	func test_subjectAlternativeNames_fakeLeaf() {

		// Given
		expect(self.sut).toNot(beNil())

		// When
		let sans = sut.getSubjectAlternativeDNSNames(OpenSSLData.certWithStuff) as? [String]

		// Then
		expect(sans).to(haveCount(2))
		// check that we skip the IP, otherName and email entry.
		expect(sans).to(contain("test1"))
		expect(sans).to(contain("test2"))
		expect(sans).toNot(contain("1.2.3.4"))

		// OpenSSL seems to keep the order the same.
		expect(sans?.first) == "test1"
		expect(sans?.last) == "test2"

		expect(self.sut.validateSubjectAlternativeDNSName("test1", forCertificateData: OpenSSLData.certWithStuff)) == true
		expect(self.sut.validateSubjectAlternativeDNSName("test2", forCertificateData: OpenSSLData.certWithStuff)) == true
		// check that we do not see the non DNS entries. IP address is a bit of an edge case. Perhaps
		// we should allow that to match.
		expect(self.sut.validateSubjectAlternativeDNSName("fo@bar", forCertificateData: OpenSSLData.certWithStuff)) == false
	}
}
